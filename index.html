<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAP NetWeaver AS Java ‚Äì Infrastructure & Software Hierarchy</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>SAP NetWeaver AS Java ‚Äì Infrastructure & Software Hierarchy</h1>
      <p>
        Complete view showing the infrastructure stack: Physical/Cloud ‚Üí
        VM/Container ‚Üí OS ‚Üí SAP Instance ‚Üí Processes ‚Üí JVM Runtime. Each layer
        clearly shows what runs on what.
      </p>
    </header>

    <main class="wrap">
      <section class="controls">
        <div class="zoom-controls">
          <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
          <div class="zoom-level" id="zoomLevel">100%</div>
          <button class="zoom-btn" onclick="zoomIn()">+</button>
          <button class="zoom-btn" onclick="resetZoom()">Reset</button>
        </div>

        <div class="legend">
          <div class="pill">
            <span class="dot" style="background: #64748b"></span>Physical/Cloud
            Infra
          </div>
          <div class="pill">
            <span class="dot" style="background: #8b5cf6"></span>VM/Host
          </div>
          <div class="pill">
            <span class="dot" style="background: #0ea5e9"></span>Operating
            System
          </div>
          <div class="pill">
            <span class="dot" style="background: #60a5fa"></span>SAP Instance
          </div>
          <div class="pill">
            <span class="dot" style="background: #34d399"></span>Process/JVM
          </div>
          <div class="pill">
            <span class="dot" style="background: #22c55e"></span>Network/Edge
          </div>
        </div>
      </section>

      <section class="diagram-shell" id="diagramShell">
        <div class="canvas-wrapper">
          <div class="canvas" id="canvas">
            <!-- EXTERNAL / NETWORK LAYER -->
            <div class="external-layer">
              <div class="layer-header">
                <div
                  class="layer-icon"
                  style="background: rgba(34, 197, 94, 0.2)"
                >
                  üåê
                </div>
                <h2 class="layer-title">External Network & Edge Layer</h2>
                <p class="layer-desc">
                  Load balancers, reverse proxies, firewalls (no VMs - typically
                  cloud services or dedicated appliances)
                </p>
              </div>
              <div class="grid grid-3">
                <div class="box">
                  <p class="box-title">DNS / Load Balancer</p>
                  <p class="box-desc">
                    Virtual IP, health checks, traffic distribution
                  </p>
                </div>
                <div class="box">
                  <p class="box-title">Reverse Proxy / WAF</p>
                  <p class="box-desc">
                    TLS termination, L7 routing, security filtering
                  </p>
                </div>
                <div class="box">
                  <p class="box-title">Firewall / Security Groups</p>
                  <p class="box-desc">Network policies, port filtering, VPN</p>
                </div>
              </div>
            </div>

            <div class="flow-arrow">‚Üì</div>
            <div class="connection-note">
              Traffic flows to SAP infrastructure
            </div>

            <!-- PHYSICAL / CLOUD INFRASTRUCTURE -->
            <div class="infra-layer layer-physical">
              <div class="layer-header">
                <div
                  class="layer-icon"
                  style="background: rgba(100, 116, 139, 0.2)"
                >
                  üèóÔ∏è
                </div>
                <h2 class="layer-title">
                  Physical / Cloud Infrastructure Layer
                </h2>
                <p class="layer-desc">
                  Bare metal servers, hypervisors, or cloud provider
                  infrastructure (AWS/Azure/GCP/On-Prem)
                </p>
              </div>

              <!-- Level 1: Central Services -->
              <div class="vm-level">
                <div class="vm-level-title">Central Services</div>
                <div class="vm-level-content">
                  <!-- ASCS VM -->
                  <div class="vm-container">
                    <div class="vm-header">
                      <span style="font-size: 18px">üíª</span>
                      <h3 class="vm-title">VM/Host: sap-ascs-01</h3>
                      <span class="badge badge-vm">Virtual Machine</span>
                      <span class="vm-specs">4 vCPU | 16GB RAM | RHEL 8</span>
                    </div>

                    <div class="os-layer">
                      <div class="os-header">
                        <span style="font-size: 14px">üêß</span>
                        <h4 class="os-title">Operating System: RHEL 8.6</h4>
                        <span class="badge badge-os">Linux</span>
                      </div>
                      <p
                        style="
                          font-size: 11px;
                          color: var(--muted);
                          margin: 0 0 12px;
                        "
                      >
                        Kernel, filesystem (/usr/sap/...), networking, user
                        management (sidadm, sapadm)
                      </p>

                      <div class="sap-instance">
                        <div class="instance-header">
                          <span style="font-size: 14px">‚öôÔ∏è</span>
                          <h5 class="instance-title">SAP Instance: ASCS00</h5>
                          <span class="badge badge-sap">Central Services</span>
                          <span class="instance-id"
                            >SID: J2E, Instance#: 00</span
                          >
                        </div>

                        <div class="process-box msg">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            Message Server (msg_server)
                          </p>
                          <p class="process-desc">
                            Central communication hub for entire SAP system
                          </p>
                          <ul class="process-details">
                            <li><b>Port:</b> 36XX (3600 for instance 00)</li>
                            <li>
                              <b>Function:</b> Maintains server list, load
                              balancing info
                            </li>
                            <li>
                              <b>Protocol:</b> SAP Message Server protocol
                            </li>
                            <li>
                              <b>Connects to:</b> All Java app server instances
                            </li>
                          </ul>
                        </div>

                        <div class="process-box enq">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            Enqueue Server (enserver)
                          </p>
                          <p class="process-desc">
                            Central lock table for distributed locks
                          </p>
                          <ul class="process-details">
                            <li><b>Port:</b> 32XX (3200 for instance 00)</li>
                            <li>
                              <b>Function:</b> Transaction locks, serialization
                            </li>
                            <li><b>Lock Table:</b> Stored in shared memory</li>
                            <li>
                              <b>Critical for:</b> Data consistency across
                              cluster
                            </li>
                          </ul>
                        </div>

                        <div
                          class="process-box"
                          style="border-color: rgba(96, 165, 250, 0.5)"
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            sapstartsrv
                          </p>
                          <p class="process-desc">
                            Instance control daemon (start/stop/status)
                          </p>
                          <ul class="process-details">
                            <li><b>Port:</b> 5XX00 (SOAP/HTTP)</li>
                            <li><b>Started by:</b> OS init system (systemd)</li>
                            <li>
                              <b>Controls:</b> Message Server, Enqueue Server
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Level 2: Java Application Servers -->
              <div class="vm-level">
                <div class="vm-level-title">Java Application Servers</div>
                <div class="vm-level-content">
                  <!-- Java App Server 1 VM -->
                  <div class="vm-container">
                    <div class="vm-header">
                      <span style="font-size: 18px">üíª</span>
                      <h3 class="vm-title">VM/Host: sap-java-app-01</h3>
                      <span class="badge badge-vm">Virtual Machine</span>
                      <span class="vm-specs">8 vCPU | 32GB RAM | RHEL 8</span>
                    </div>

                    <div class="os-layer">
                      <div class="os-header">
                        <span style="font-size: 14px">üêß</span>
                        <h4 class="os-title">Operating System: RHEL 8.6</h4>
                        <span class="badge badge-os">Linux</span>
                      </div>
                      <p
                        style="
                          font-size: 11px;
                          color: var(--muted);
                          margin: 0 0 12px;
                        "
                      >
                        SAP JVM installed at
                        /usr/sap/J2E/SYS/exe/uc/linuxx86_64, instance
                        directories, j2eadm user
                      </p>

                      <div class="sap-instance">
                        <div class="instance-header">
                          <span style="font-size: 14px">‚òï</span>
                          <h5 class="instance-title">SAP Instance: JC01</h5>
                          <span class="badge badge-sap"
                            >Java Central Instance</span
                          >
                          <span class="instance-id"
                            >SID: J2E, Instance#: 01</span
                          >
                        </div>

                        <div class="process-box icm">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            ICM (Internet Communication Manager)
                          </p>
                          <p class="process-desc">
                            HTTP(S) entry point - native C++ process
                          </p>
                          <ul class="process-details">
                            <li>
                              <b>Ports:</b> 80XX (8001), 443XX (44301) for HTTPS
                            </li>
                            <li>
                              <b>Function:</b> Accept HTTP requests, TLS
                              handling
                            </li>
                            <li>
                              <b>Forwards to:</b> Dispatcher via local IPC
                            </li>
                            <li>
                              <b>Binary:</b> /usr/sap/.../icman (C++ executable)
                            </li>
                          </ul>
                        </div>

                        <div class="process-box dispatcher">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            Dispatcher (disp+work)
                          </p>
                          <p class="process-desc">
                            Request router - native C++ process
                          </p>
                          <ul class="process-details">
                            <li>
                              <b>Port:</b> P4 port for internal communication
                            </li>
                            <li>
                              <b>Function:</b> Load balance to JVM nodes,
                              session affinity
                            </li>
                            <li>
                              <b>Manages:</b> Node list, health checks, failover
                            </li>
                            <li>
                              <b>Connects to:</b> Message Server for cluster
                              info
                            </li>
                          </ul>
                        </div>

                        <div
                          class="process-box"
                          style="border-color: rgba(96, 165, 250, 0.5)"
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            sapstartsrv
                          </p>
                          <p class="process-desc">
                            Controls this instance's processes
                          </p>
                          <ul class="process-details">
                            <li>
                              <b>Starts:</b> ICM, Dispatcher, JVM nodes via
                              jstart
                            </li>
                            <li>
                              <b>Monitors:</b> Process health, automatic restart
                            </li>
                          </ul>
                        </div>

                        <div class="process-box jvm">
                          <p class="process-title">
                            <span class="badge badge-process">JVM Process</span>
                            Java Server Node 0 (server0)
                          </p>
                          <p class="process-desc">
                            SAP JVM instance running Java EE application server
                          </p>
                          <ul class="process-details">
                            <li><b>Started by:</b> jstart (Java launcher)</li>
                            <li>
                              <b>JVM Heap:</b> -Xmx4096M (configured in instance
                              profile)
                            </li>
                            <li>
                              <b>P4 Port:</b> 5XX04 (for dispatcher
                              communication)
                            </li>
                            <li>
                              <b>Debug Port:</b> 5XX08 (if debugging enabled)
                            </li>
                          </ul>

                          <div class="jvm-internals">
                            <p
                              style="
                                font-size: 11px;
                                font-weight: 700;
                                margin: 0 0 8px;
                                color: var(--ink);
                              "
                            >
                              Inside JVM Process Memory:
                            </p>

                            <div class="jvm-section">
                              <p class="jvm-section-title">
                                üîπ Java EE / Jakarta EE Runtime
                              </p>
                              <ul class="jvm-items">
                                <li>
                                  Servlet Container - handles HTTP requests from
                                  dispatcher
                                </li>
                                <li>
                                  EJB Container - business logic components
                                </li>
                                <li>
                                  Web Services Runtime - SOAP/REST endpoints
                                </li>
                                <li>
                                  JPA / Persistence - ORM for database access
                                </li>
                                <li>JMS Provider - asynchronous messaging</li>
                              </ul>
                            </div>

                            <div class="jvm-section">
                              <p class="jvm-section-title">
                                üîπ SAP Java Engine Services
                              </p>
                              <ul class="jvm-items">
                                <li>
                                  Service Framework - lifecycle management of
                                  SAP services
                                </li>
                                <li>
                                  Deploy Service - handles SCA/SDA deployment
                                </li>
                                <li>
                                  Cluster Service - communicates with Message
                                  Server
                                </li>
                                <li>
                                  Locking Service - interacts with Enqueue
                                  Server
                                </li>
                                <li>
                                  Configuration Service - reads/writes config to
                                  DB
                                </li>
                                <li>
                                  Log & Trace Service - application logging
                                </li>
                              </ul>
                            </div>

                            <div class="jvm-section">
                              <p class="jvm-section-title">
                                üîπ Deployed Applications
                              </p>
                              <ul class="jvm-items">
                                <li>Web Dynpro Runtime - UI framework</li>
                                <li>
                                  SAP NetWeaver Portal - portal server runtime
                                </li>
                                <li>
                                  Custom Java Applications - business apps
                                </li>
                                <li>
                                  SAP JCo - RFC connector for ABAP systems
                                </li>
                                <li>JDBC Drivers - database connectivity</li>
                              </ul>
                            </div>

                            <div class="jvm-section">
                              <p class="jvm-section-title">
                                üîπ Thread Pools & Resources
                              </p>
                              <ul class="jvm-items">
                                <li>
                                  HTTP Worker Threads - process servlet requests
                                </li>
                                <li>EJB Thread Pool - handle EJB calls</li>
                                <li>
                                  Connection Pools - JDBC, JCo, JMS connections
                                </li>
                                <li>Session Manager - HTTP session cache</li>
                              </ul>
                            </div>
                          </div>
                        </div>

                        <div class="process-box jvm">
                          <p class="process-title">
                            <span class="badge badge-process">JVM Process</span>
                            Java Server Node 1 (server1)
                          </p>
                          <p class="process-desc">
                            Second JVM instance for parallel request processing
                          </p>
                          <ul class="process-details">
                            <li>
                              <b>Same structure as Node 0</b> - independent JVM
                            </li>
                            <li>
                              <b>JVM Heap:</b> -Xmx4096M (separate memory space)
                            </li>
                            <li><b>P4 Port:</b> 5XX05</li>
                            <li>
                              <b>Purpose:</b> Horizontal scaling within same VM
                            </li>
                            <li>
                              <b>Session Sharing:</b> Via database or cluster
                              replication
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Java App Server 2 VM -->
                  <div class="vm-container">
                    <div class="vm-header">
                      <span style="font-size: 18px">üíª</span>
                      <h3 class="vm-title">VM/Host: sap-java-app-02</h3>
                      <span class="badge badge-vm">Virtual Machine</span>
                      <span class="vm-specs">8 vCPU | 32GB RAM | RHEL 8</span>
                    </div>

                    <div class="os-layer">
                      <div class="os-header">
                        <span style="font-size: 14px">üêß</span>
                        <h4 class="os-title">Operating System: RHEL 8.6</h4>
                        <span class="badge badge-os">Linux</span>
                      </div>
                      <p
                        style="
                          font-size: 11px;
                          color: var(--muted);
                          margin: 0 0 12px;
                        "
                      >
                        Same OS setup as app-01, separate VM for scale-out
                      </p>

                      <div class="sap-instance">
                        <div class="instance-header">
                          <span style="font-size: 14px">‚òï</span>
                          <h5 class="instance-title">SAP Instance: JC02</h5>
                          <span class="badge badge-sap">Java App Instance</span>
                          <span class="instance-id"
                            >SID: J2E, Instance#: 02</span
                          >
                        </div>

                        <div class="process-box icm">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            ICM
                          </p>
                          <p class="process-desc">
                            Another ICM instance (load balanced with app-01)
                          </p>
                          <ul class="process-details">
                            <li><b>Ports:</b> 80XX (8002), 443XX (44302)</li>
                            <li>
                              <b>Load Balancer:</b> Distributes traffic between
                              app-01 and app-02 ICMs
                            </li>
                          </ul>
                        </div>

                        <div class="process-box dispatcher">
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            Dispatcher
                          </p>
                          <p class="process-desc">
                            Routes to local nodes (server0, server1 on this VM)
                          </p>
                        </div>

                        <div
                          class="process-box"
                          style="border-color: rgba(96, 165, 250, 0.5)"
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            sapstartsrv
                          </p>
                        </div>

                        <div class="process-box jvm">
                          <p class="process-title">
                            <span class="badge badge-process">JVM Process</span>
                            Java Server Node 0 (server0)
                          </p>
                          <p class="process-desc">
                            Same JVM structure as app-01, different P4 port
                          </p>
                          <ul class="process-details">
                            <li><b>All nodes connect to same database</b></li>
                            <li>
                              <b>All nodes register with Message Server</b>
                            </li>
                            <li>
                              <b>All nodes use Enqueue Server for locks</b>
                            </li>
                          </ul>
                        </div>

                        <div class="process-box jvm">
                          <p class="process-title">
                            <span class="badge badge-process">JVM Process</span>
                            Java Server Node 1 (server1)
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Level 3: Database -->
              <div class="vm-level">
                <div class="vm-level-title">Database</div>
                <div class="vm-level-content">
                  <!-- Database VM -->
                  <div class="vm-container">
                    <div class="vm-header">
                      <span style="font-size: 18px">üíª</span>
                      <h3 class="vm-title">VM/Host: sap-hana-db-01</h3>
                      <span class="badge badge-vm">Virtual Machine</span>
                      <span class="vm-specs"
                        >16 vCPU | 128GB RAM | SLES 15</span
                      >
                    </div>

                    <div class="os-layer">
                      <div class="os-header">
                        <span style="font-size: 14px">üêß</span>
                        <h4 class="os-title">
                          Operating System: SUSE Linux Enterprise Server 15
                        </h4>
                        <span class="badge badge-os">Linux</span>
                      </div>
                      <p
                        style="
                          font-size: 11px;
                          color: var(--muted);
                          margin: 0 0 12px;
                        "
                      >
                        HANA-optimized kernel, huge pages configured, HANA user
                        (j2eadm)
                      </p>

                      <div class="sap-instance">
                        <div class="instance-header">
                          <span style="font-size: 14px">üóÑÔ∏è</span>
                          <h5 class="instance-title">SAP HANA Database</h5>
                          <span class="badge badge-sap">Database Instance</span>
                          <span class="instance-id">SID: J2E, Tenant: J2E</span>
                        </div>

                        <div
                          class="process-box"
                          style="
                            border-color: rgba(251, 146, 60, 0.6);
                            background: linear-gradient(
                              135deg,
                              rgba(251, 146, 60, 0.12),
                              rgba(15, 23, 48, 0.85)
                            );
                          "
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            hdbindexserver
                          </p>
                          <p class="process-desc">
                            Main HANA database engine process
                          </p>
                          <ul class="process-details">
                            <li><b>Port:</b> 3XX13 (30013 for instance 00)</li>
                            <li>
                              <b>Protocol:</b> SQL via JDBC from JVM nodes
                            </li>
                            <li>
                              <b>Stores:</b> Java schema - config tables,
                              deployment metadata, app data
                            </li>
                            <li>
                              <b>Tables:</b> BC_*, deployment units, cluster
                              state, etc.
                            </li>
                          </ul>
                        </div>

                        <div
                          class="process-box"
                          style="
                            border-color: rgba(251, 146, 60, 0.6);
                            background: linear-gradient(
                              135deg,
                              rgba(251, 146, 60, 0.12),
                              rgba(15, 23, 48, 0.85)
                            );
                          "
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            hdbdaemon
                          </p>
                          <p class="process-desc">
                            HANA lifecycle management daemon
                          </p>
                        </div>

                        <div
                          class="process-box"
                          style="
                            border-color: rgba(251, 146, 60, 0.6);
                            background: linear-gradient(
                              135deg,
                              rgba(251, 146, 60, 0.12),
                              rgba(15, 23, 48, 0.85)
                            );
                          "
                        >
                          <p class="process-title">
                            <span class="badge badge-process">Process</span>
                            hdbcompileserver, hdbpreprocessor
                          </p>
                          <p class="process-desc">
                            SQL compilation and query processing
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div
              style="
                margin-top: 32px;
                padding: 20px;
                background: rgba(16, 26, 51, 0.65);
                border: 1px solid var(--line);
                border-radius: 12px;
              "
            >
              <h3 style="margin: 0 0 14px; font-size: 14px">
                üìä Key Communication Flows:
              </h3>
              <ul
                style="
                  margin: 0;
                  padding-left: 20px;
                  color: var(--muted);
                  font-size: 11.5px;
                  line-height: 1.6;
                "
              >
                <li>
                  <b>User Request Flow:</b> Browser ‚Üí Load Balancer ‚Üí ICM
                  (VM1/VM2) ‚Üí Dispatcher ‚Üí JVM Node ‚Üí Database
                </li>
                <li>
                  <b>Cluster Communication:</b> All JVM Nodes ‚Üî Message Server
                  (ASCS VM) for server list and cluster info
                </li>
                <li>
                  <b>Locking:</b> All JVM Nodes ‚Üî Enqueue Server (ASCS VM) for
                  distributed locks
                </li>
                <li>
                  <b>Persistence:</b> All JVM Nodes ‚Üí Database (JDBC
                  connections) for config, metadata, app data
                </li>
                <li>
                  <b>Session Replication:</b> JVM Nodes ‚Üî Database (if DB
                  session store) or JVM-to-JVM (if in-memory replication)
                </li>
                <li>
                  <b>Management:</b> Admin tools ‚Üí sapstartsrv (each VM) ‚Üí
                  Control processes via SOAP/HTTP
                </li>
              </ul>
            </div>

            <div
              style="
                margin-top: 20px;
                padding: 20px;
                background: rgba(16, 26, 51, 0.65);
                border: 1px solid var(--line);
                border-radius: 12px;
              "
            >
              <h3 style="margin: 0 0 14px; font-size: 14px">
                üîß Infrastructure Scaling Patterns:
              </h3>
              <ul
                style="
                  margin: 0;
                  padding-left: 20px;
                  color: var(--muted);
                  font-size: 11.5px;
                  line-height: 1.6;
                "
              >
                <li>
                  <b>Scale-up:</b> Add more vCPU/RAM to existing VMs, increase
                  JVM heap sizes
                </li>
                <li>
                  <b>Scale-out (nodes):</b> Add more JVM nodes to existing VMs
                  (limited by VM resources)
                </li>
                <li>
                  <b>Scale-out (VMs):</b> Add more Java app server VMs
                  (sap-java-app-03, 04, etc.) - unlimited horizontal scaling
                </li>
                <li>
                  <b>High Availability:</b> Add standby ASCS VM, configure
                  database replication (HANA System Replication), use load
                  balancer health checks
                </li>
                <li>
                  <b>Disaster Recovery:</b> Replicate database to secondary
                  datacenter, keep standby VMs ready
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Component Info Modal -->
    <div id="componentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle"></h2>
          <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
