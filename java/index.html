<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAP NetWeaver AS Java ‚Äì Infrastructure & Software Hierarchy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-50">
      <div class="max-w-[98%] mx-auto flex flex-col gap-1">
        <h1 class="text-xl font-bold flex items-center gap-2">
          <span class="text-2xl">‚òï</span>
          SAP NetWeaver AS Java <span class="text-slate-400 font-normal text-sm ml-2">Infrastructure & Software Hierarchy</span>
        </h1>
        <p class="text-xs text-slate-400 max-w-[90%]">
          Physical/Cloud ‚Üí VM/Container ‚Üí OS ‚Üí SAP Instance ‚Üí Processes ‚Üí JVM Runtime
        </p>
      </div>
    </header>

    <main class="wrap px-4 py-6 flex-grow flex flex-col gap-4 h-[calc(100vh-80px)]">
      
      <!-- Controls Toolbar -->
      <section class="controls flex flex-wrap items-center gap-4 bg-white p-3 rounded-xl shadow border border-slate-200 sticky top-[72px] z-40">
        
        <!-- View Switcher -->
        <div class="bg-slate-100 p-1 rounded-lg flex space-x-1">
          <button class="view-btn px-3 py-1.5 rounded-md text-sm font-semibold text-slate-600 hover:bg-white hover:shadow-sm transition-all active bg-white text-blue-600 shadow-sm ring-1 ring-slate-200" id="topologyViewBtn" onclick="switchView('topology')">
            Topology View
          </button>
          <button class="view-btn px-3 py-1.5 rounded-md text-sm font-semibold text-slate-600 hover:bg-white hover:shadow-sm transition-all" id="flowViewBtn" onclick="switchView('flow')">
            Flow View
          </button>
        </div>

        <div class="h-6 w-px bg-slate-300 mx-2"></div>

        <!-- Topology Controls -->
        <div class="zoom-controls flex items-center gap-2" id="topologyControls">
          <button class="zoom-btn w-8 h-8 flex items-center justify-center bg-white border border-slate-300 rounded text-slate-600 hover:bg-slate-50 font-bold" onclick="zoomOut()">‚àí</button>
          <div class="zoom-level text-xs font-mono text-slate-500 w-12 text-center" id="zoomLevel">100%</div>
          <button class="zoom-btn w-8 h-8 flex items-center justify-center bg-white border border-slate-300 rounded text-slate-600 hover:bg-slate-50 font-bold" onclick="zoomIn()">+</button>
          <button class="zoom-btn px-3 py-1 bg-white border border-slate-300 rounded text-xs font-semibold text-slate-600 hover:bg-slate-50" onclick="resetZoom()">Reset</button>
        </div>

        <div class="vm-width-controls flex items-center gap-2 text-xs text-slate-500 bg-slate-50 px-2 py-1 rounded border border-slate-200">
          <label for="vmWidthSlider" class="uppercase font-bold tracking-wider">VM Width</label>
          <input type="range" id="vmWidthSlider" min="180" max="420" step="10" class="accent-blue-500 h-1 bg-slate-300 rounded appearance-none" />
          <span id="vmWidthValue" class="font-mono">360px</span>
        </div>

        <!-- Scaling Controls -->
        <div class="scaling-controls flex gap-2" id="topologyControls2">
          <button class="zoom-btn px-3 py-1 bg-blue-50 border border-blue-200 text-blue-700 rounded text-xs font-bold hover:bg-blue-100 transition-colors" onclick="addJavaAppServer()">
            + Java App Server
          </button>
          <button class="zoom-btn px-3 py-1 bg-red-50 border border-red-200 text-red-700 rounded text-xs font-bold hover:bg-red-100 transition-colors" onclick="removeJavaAppServer()">
            ‚àí App Server
          </button>
        </div>

        <!-- Flow Controls -->
        <div class="flow-controls flex gap-2 items-center" id="flowControls" style="display: none;">
          <select id="flowSelector" class="flow-select text-sm p-1.5 border border-slate-300 rounded bg-white text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
            <option value="http">Flow 1: User HTTP Request</option>
            <option value="cluster">Flow 2: Java Cluster Coordination</option>
            <option value="startup">Flow 3: System Startup</option>
          </select>
          <button class="zoom-btn px-3 py-1.5 bg-green-50 text-green-700 border border-green-200 rounded text-xs font-bold hover:bg-green-100" id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂ Play</button>
          <button class="zoom-btn px-2 py-1.5 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" onclick="stepBackward()">‚óÄ‚óÄ</button>
          <button class="zoom-btn px-2 py-1.5 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" onclick="stepForward()">‚ñ∂‚ñ∂</button>
          <button class="zoom-btn px-3 py-1.5 bg-slate-50 border border-slate-200 rounded text-xs font-semibold text-slate-600 hover:bg-slate-100" onclick="restartFlow()">‚Üª Restart</button>
        </div>

        <div class="flex-grow"></div>

        <!-- Legend -->
        <div class="legend flex gap-3 text-[10px] text-slate-500">
           <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-slate-400"></span>Infra</div>
           <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-slate-600 shadow-sm border border-white"></span>VM</div>
           <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-sky-200 border border-sky-400"></span>OS</div>
           <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-orange-200 border border-orange-400"></span>SAP Instance</div>
           <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-white border-2 border-slate-300"></span>Process</div>
        </div>
      </section>

      <!-- Topology View -->
      <section class="diagram-shell flex-grow rounded-xl bg-slate-100 border border-slate-300 shadow-inner overflow-auto relative" id="topologyView" id="diagramShell">
        <div class="canvas-wrapper p-10 min-w-full min-h-full inline-block">
          <div class="canvas relative w-[1200px] max-w-full mx-auto" id="canvas">
            
            <!-- EXTERNAL / NETWORK LAYER -->
            <div class="external-layer bg-green-50 border border-green-200 rounded-2xl p-4 mb-6 shadow-sm">
              <div class="layer-header flex items-center gap-3 mb-4 border-b border-green-100 pb-2">
                <div class="layer-icon w-8 h-8 flex items-center justify-center bg-green-100 text-green-600 rounded-lg text-lg">üåê</div>
                <div>
                  <h2 class="layer-title text-base font-bold text-green-900">External Network & Edge Layer</h2>
                  <p class="layer-desc text-xs text-green-600">Load balancers, reverse proxies, firewalls</p>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div class="box bg-white border border-green-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                  <p class="box-title text-xs font-bold text-green-800 mb-1">DNS / Load Balancer</p>
                  <p class="box-desc text-[10px] text-slate-500 leading-tight">Virtual IP, health checks, traffic distribution</p>
                </div>
                <div class="box bg-white border border-green-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                  <p class="box-title text-xs font-bold text-green-800 mb-1">Reverse Proxy / WAF</p>
                  <p class="box-desc text-[10px] text-slate-500 leading-tight">TLS termination, L7 routing, security</p>
                </div>
                <div class="box bg-white border border-green-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                  <p class="box-title text-xs font-bold text-green-800 mb-1">Firewall / Security Groups</p>
                  <p class="box-desc text-[10px] text-slate-500 leading-tight">Network policies, port filtering</p>
                </div>
              </div>
            </div>



            <!-- PHYSICAL / CLOUD INFRASTRUCTURE (Wrapper Removed) -->
            <div class="fluid-infra mt-8">

              <!-- Level 1: Central Services -->
              <div class="vm-level mb-6">
                <div class="vm-level-title text-[10px] uppercase font-bold text-slate-400 tracking-wider mb-2">Central Services</div>
                <div class="vm-level-content flex flex-wrap gap-4">
                  
                  <!-- ASCS VM -->
                  <div class="vm-container bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl p-3 shadow-sm hover:border-slate-400 hover:shadow-md transition-all cursor-pointer flex-none w-[360px]">
                    <div class="vm-header flex items-center gap-2 mb-3 bg-white p-2 rounded border border-slate-200 shadow-sm">
                      <span class="text-lg">üíª</span>
                      <h3 class="vm-title text-xs font-bold text-slate-700">VM/Host: sap-ascs-01</h3>
                      <span class="badge badge-vm text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded border border-slate-200">Virtual Machine</span>
                      <span class="vm-specs ml-auto text-[9px] font-mono text-slate-400">4 vCPU | 16GB</span>
                    </div>

                    <div class="os-layer bg-sky-50 border border-sky-200 rounded-lg p-2 mb-3">
                      <div class="os-header flex items-center gap-2 mb-1">
                        <span class="text-sm">üêß</span>
                        <h4 class="os-title text-[11px] font-bold text-sky-700">OS: RHEL 8.6</h4>
                        <span class="badge badge-os text-[9px] bg-sky-100 text-sky-600 px-2 py-0.5 rounded border border-sky-200">Linux</span>
                      </div>
                      <p class="text-[10px] text-slate-500 mb-2 leading-tight">Kernel, filesystem, networking, sidadm</p>

                      <div class="sap-instance bg-blue-50 border border-blue-200 rounded-lg p-2.5 shadow-sm">
                        <div class="instance-header flex items-center gap-2 mb-2 bg-white/60 p-1.5 rounded border border-blue-100">
                          <span class="text-sm">‚öôÔ∏è</span>
                          <h5 class="instance-title text-[11px] font-bold text-blue-900">SAP Instance: ASCS00</h5>
                          <span class="badge badge-role text-[9px] bg-slate-800 text-white px-1.5 py-0.5 rounded uppercase font-bold tracking-wide">ASCS</span>
                          <span class="instance-id text-[8px] text-slate-400 ml-auto">Instance# 00</span>
                        </div>

                        <div class="process-box msg bg-white border border-blue-200 rounded p-2 mb-2 shadow-sm hover:translate-y-px transition-transform cursor-pointer">
                           <p class="process-title text-[10px] font-bold text-blue-800 flex items-center gap-2 mb-1">
                             <span class="badge badge-process bg-blue-50 text-blue-500 px-1.5 rounded border border-blue-100 text-[8px]">Proc</span>
                             Message Server (msg_server)
                           </p>
                           <p class="process-desc text-[9px] text-slate-500 leading-tight">Control hub for cluster, load balancing info.</p>
                        </div>

                        <div class="process-box enq bg-white border border-blue-200 rounded p-2 shadow-sm hover:translate-y-px transition-transform cursor-pointer">
                           <p class="process-title text-[10px] font-bold text-blue-800 flex items-center gap-2 mb-1">
                             <span class="badge badge-process bg-blue-50 text-blue-500 px-1.5 rounded border border-blue-100 text-[8px]">Proc</span>
                             Enqueue Server (enserver)
                           </p>
                           <p class="process-desc text-[9px] text-slate-500 leading-tight">Distributed lock management.</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Level 2: Java Application Servers -->
              <div class="vm-level mb-6">
                <div class="vm-level-title text-[10px] uppercase font-bold text-slate-400 tracking-wider mb-2">Java Application Servers</div>
                <div class="vm-level-content flex flex-wrap gap-4">
                  
                  <!-- Java PAS VM -->
                  <div class="vm-container bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl p-3 shadow-sm hover:border-slate-400 hover:shadow-md transition-all cursor-pointer flex-none w-[360px]">
                    <div class="vm-header flex items-center gap-2 mb-3 bg-white p-2 rounded border border-slate-200 shadow-sm">
                      <span class="text-lg">üíª</span>
                      <h3 class="vm-title text-xs font-bold text-slate-700">VM/Host: sap-java-app-01</h3>
                      <span class="badge badge-vm text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded border border-slate-200">VM</span>
                      <span class="vm-specs ml-auto text-[9px] font-mono text-slate-400">8 vCPU | 32GB</span>
                    </div>

                    <div class="os-layer bg-sky-50 border border-sky-200 rounded-lg p-2 mb-3">
                      <div class="os-header flex items-center gap-2 mb-1">
                        <span class="text-sm">üêß</span>
                        <h4 class="os-title text-[11px] font-bold text-sky-700">OS: RHEL 8.6</h4>
                      </div>
                      <p class="text-[10px] text-slate-500 mb-2 leading-tight">/usr/sap/J2E, j2eadm user</p>

                      <!-- Updated to Orange Theme for Java Instance -->
                      <div class="sap-instance bg-orange-50 border border-orange-200 rounded-lg p-2.5 shadow-sm">
                        <div class="instance-header flex items-center gap-2 mb-2 bg-white/60 p-1.5 rounded border border-orange-100">
                          <span class="text-sm">‚òï</span>
                          <h5 class="instance-title text-[11px] font-bold text-orange-900">SAP Java PAS</h5>
                          <span class="badge badge-role text-[9px] bg-slate-800 text-white px-1.5 py-0.5 rounded uppercase font-bold tracking-wide">PAS</span>
                          <span class="instance-id text-[8px] text-slate-400 ml-auto">Instance# 01</span>
                        </div>

                        <!-- sapstartsrv -->
                        <div class="process-box bg-white border border-slate-200 rounded p-2 mb-2 shadow-sm">
                           <p class="process-title text-[10px] font-bold text-slate-700 mb-1">
                             <span class="badge badge-process bg-slate-100 text-slate-500 px-1 text-[8px] rounded border">Daemon</span>
                             sapstartsrv
                           </p>
                        </div>

                        <!-- ICM (Purple) -->
                        <div class="process-box icm bg-purple-50 border border-purple-200 rounded p-2 mb-2 shadow-sm">
                           <p class="process-title text-[10px] font-bold text-purple-900 mb-1">ICM (Internet Comm. Mgr)</p>
                           <p class="process-desc text-[9px] text-slate-500">HTTP/HTTPS entry point.</p>
                        </div>

                        <!-- Dispatcher (Orange) -->
                        <div class="process-box dispatcher bg-orange-50 border border-orange-200 rounded p-2 mb-2 shadow-sm">
                           <p class="process-title text-[10px] font-bold text-orange-900 mb-1">Java Dispatcher</p>
                           <p class="process-desc text-[9px] text-slate-500">Distributes requests to JVM nodes.</p>
                        </div>

                        <!-- JVM Nodes -->
                        <div class="jvm-node-group mt-2">
                           <div class="jvm-node-group-header flex justify-between items-baseline mb-1">
                             <p class="jvm-node-group-title text-[10px] font-bold text-slate-700">Java Server Nodes</p>
                             <p class="jvm-node-group-note text-[8px] text-slate-400">Cluster Members</p>
                           </div>

                           <div class="process-box jvm bg-amber-50 border border-amber-200 rounded p-2 mb-2 shadow-sm">
                              <p class="process-title text-[10px] font-bold text-amber-900 mb-1">JVM Node 0 (server0)</p>
                              
                              <div class="jvm-internals mt-2 p-2 bg-white rounded border border-amber-100">
                                <p class="text-[9px] font-bold text-slate-700 mb-1">JVM Internals:</p>
                                <div class="jvm-section bg-slate-50 p-1.5 rounded mb-1 border border-slate-100">
                                  <p class="jvm-section-title text-[9px] font-bold text-slate-600">üîπ Java EE Runtime</p>
                                  <ul class="jvm-items text-[8px] text-slate-500 pl-2">
                                    <li>Servlet Container</li>
                                    <li>EJB Container</li>
                                  </ul>
                                </div>
                                <div class="jvm-section bg-slate-50 p-1.5 rounded mb-1 border border-slate-100">
                                  <p class="jvm-section-title text-[9px] font-bold text-slate-600">üîπ Services</p>
                                  <ul class="jvm-items text-[8px] text-slate-500 pl-2">
                                    <li>Deploy, Cluster, Locking</li>
                                  </ul>
                                </div>
                              </div>
                           </div>

                             <div class="process-box jvm bg-amber-50 border border-amber-200 rounded p-2 shadow-sm opacity-80">
                                <p class="process-title text-[10px] font-bold text-amber-900 mb-0">JVM Node 1 (server1)</p>
                             </div>
                        </div>

                      </div>
                    </div>
                  </div>
                  <!-- Dynamic servers added here -->
                </div>
              </div>

              <!-- Level 3: Database -->
              <div class="vm-level pb-4">
                <div class="vm-level-title text-[10px] uppercase font-bold text-slate-400 tracking-wider mb-2">Database</div>
                <div class="vm-level-content flex flex-wrap gap-4">
                  
                  <!-- Database VM -->
                  <div class="vm-container bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl p-3 shadow-sm hover:border-slate-400 transition-all cursor-pointer flex-none w-[360px]">
                    <div class="vm-header flex items-center gap-2 mb-3 bg-white p-2 rounded border border-slate-200 shadow-sm">
                       <span class="text-lg">üíª</span>
                       <h3 class="vm-title text-xs font-bold text-slate-700">VM/Host: sap-hana-db-01</h3>
                       <span class="badge badge-vm text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded border border-slate-200">Virtual Machine</span>
                    </div>

                     <div class="os-layer bg-sky-50 border border-sky-200 rounded-lg p-2 mb-3">
                         <div class="os-header flex items-center gap-2 mb-1">
                             <span class="text-sm">üêß</span>
                             <h4 class="os-title text-[11px] font-bold text-sky-700">OS: SLES 15</h4>
                         </div>
                         
                         <div class="sap-instance bg-slate-100 border border-slate-300 rounded-lg p-2.5 shadow-sm">
                             <div class="instance-header flex items-center gap-2 mb-2 bg-white/60 p-1.5 rounded border border-slate-200">
                                 <span class="text-sm">üóÑÔ∏è</span>
                                 <h5 class="instance-title text-[11px] font-bold text-slate-800">SAP HANA Database</h5>
                             </div>

                             <div class="process-box bg-white border border-slate-300 rounded p-2 mb-1 shadow-sm">
                                <p class="process-title text-[10px] font-bold text-slate-800 mb-1">hdbindexserver</p>
                                <p class="process-desc text-[9px] text-slate-500">Main DB engine. Stores Java Schema.</p>
                             </div>
                             <div class="process-box bg-white border border-slate-300 rounded p-2 shadow-sm">
                                <p class="process-title text-[10px] font-bold text-slate-800 mb-1">hdbdaemon</p>
                             </div>
                         </div>
                     </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- Flow View Shell (Hidden by default) -->
      <section class="flow-view-shell hidden bg-white rounded-xl border border-slate-200 p-8 min-h-[600px] relative shadow-sm" id="flowView">
        <div class="flow-view-container h-full">
           <div class="flow-canvas relative h-full w-full" id="flowCanvas">
              <!-- Components managed by script.js -->
              <div class="flow-component absolute bg-white border-2 border-slate-300 rounded-lg p-3 shadow-md w-40" id="client">
                 <div class="flow-comp-title text-xs font-bold text-center text-slate-700">Client / Browser</div>
              </div>
           </div>
        </div>
      </section>

    </main>

    <!-- Component Modal -->
    <div id="componentModal" class="modal hidden fixed inset-0 bg-black/50 z-[100] flex items-center justify-center backdrop-blur-sm">
       <div class="modal-content bg-white rounded-xl shadow-2xl w-[90%] max-w-[500px] overflow-hidden border border-slate-200 animate-[fadeIn_0.2s_ease-out]">
          <div class="modal-header bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
             <h2 id="modalTitle" class="text-base font-bold text-slate-800 flex items-center gap-2">Component Info</h2>
             <button id="modalClose" class="text-slate-400 hover:text-slate-600 text-xl font-bold">&times;</button>
          </div>
          <div id="modalBody" class="p-6 text-sm text-slate-600 space-y-4 max-h-[70vh] overflow-y-auto">
             <!-- Dynamic Content -->
          </div>
       </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
